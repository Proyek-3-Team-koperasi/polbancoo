# Database Schema V1
Di bawah ini adalah skema database awal kami yang dibuat dengan sintaks dbdiagram.io

```
// ===================================================
// Skema Database untuk Aplikasi KopSy-Campus
// ===================================================
// Dibuat dengan sintaks DBML untuk dbdiagram.io
// ===================================================

// --- Modul Keanggotaan dan Otentikasi ---

Table users {
  id integer [pk, increment]
  name varchar(255) [not null]
  email varchar(255) [unique, not null]
  password varchar(255) [not null, note: 'Gunakan Hashing (e.g., bcrypt)']
  remember_token varchar(100)
  email_verified_at timestamp
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table roles {
  id integer [pk, increment]
  name varchar(50) [unique, not null, note: 'Contoh: Anggota, Admin, Super Admin']
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table role_user {
  user_id integer [ref: > users.id]
  role_id integer [ref: > roles.id]
  
  Indexes {
    (user_id, role_id) [pk]
  }
}

Table members {
  user_id integer [pk, ref: > users.id]
  member_id_number varchar(50) [unique, not null, note: 'Bisa NIM/NIDN/NIP']
  faculty_or_unit varchar(100)
  status varchar(50) [not null, default: 'Pending', note: 'Pending, Active, Inactive']
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

// --- Modul Simpanan Anggota ---

Table savings_accounts {
  id integer [pk, increment]
  member_user_id integer [unique, not null, ref: > members.user_id]
  // Saldo-saldo ini direkomendasikan sebagai hasil kalkulasi dari transaksi
  // untuk menjaga integritas data (data of record ada di transactions)
  // Namun, bisa disimpan di sini untuk kemudahan query.
  principal_saving decimal(15, 2) [not null, default: 0, note: 'Simpanan Pokok']
  mandatory_saving decimal(15, 2) [not null, default: 0, note: 'Total Simpanan Wajib']
  voluntary_saving decimal(15, 2) [not null, default: 0, note: 'Total Simpanan Sukarela']
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table savings_transactions {
  id integer [pk, increment]
  savings_account_id integer [not null, ref: > savings_accounts.id]
  admin_user_id integer [not null, ref: > users.id, note: 'Admin yang mencatat transaksi']
  amount decimal(15, 2) [not null]
  type varchar(50) [not null, note: 'Principal, Mandatory, Voluntary, Withdrawal']
  description text
  transaction_date date [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

// --- Modul Katalog Produk (Marketplace) ---

Table product_categories {
  id integer [pk, increment]
  name varchar(100) [unique, not null]
  slug varchar(120) [unique, not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table products {
  id integer [pk, increment]
  category_id integer [ref: > product_categories.id]
  name varchar(255) [not null]
  slug varchar(255) [unique, not null]
  description text
  image_url varchar(255)
  cost_price decimal(15, 2) [not null, note: 'Harga Pokok/Beli']
  cash_price decimal(15, 2) [not null, note: 'Harga Jual Tunai']
  stock integer [not null, default: 0]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}


// --- Modul Transaksi dan Pembiayaan ---

Table orders {
  id integer [pk, increment]
  member_user_id integer [not null, ref: > members.user_id]
  order_date timestamp [not null, default: `now()`]
  status varchar(50) [not null, note: 'Pending Payment, Processing, Shipped, Completed, Cancelled']
  total_amount decimal(15, 2) [not null]
  payment_method varchar(50) [not null, note: 'Cash, Murabahah']
  // Kolom lain bisa ditambahkan seperti alamat pengiriman, dll.
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table order_items {
  id integer [pk, increment]
  order_id integer [not null, ref: > orders.id]
  product_id integer [not null, ref: > products.id]
  quantity integer [not null]
  // Harga disimpan saat transaksi terjadi untuk menjaga historis harga
  price decimal(15, 2) [not null, note: 'Harga produk saat dibeli (bisa harga tunai atau harga jual murabahah)']
  
  Indexes {
    (order_id, product_id) [unique]
  }
}

Table financing_applications {
  id integer [pk, increment]
  order_id integer [unique, not null, ref: > orders.id]
  member_user_id integer [not null, ref: > members.user_id]
  admin_user_id integer [ref: > users.id, note: 'Admin yang menyetujui/menolak']
  tenor integer [not null, note: 'Jangka waktu dalam bulan']
  cost_price_total decimal(15, 2) [not null, note: 'Total Harga Pokok dari barang di order']
  margin decimal(15, 2) [not null, note: 'Margin keuntungan koperasi']
  selling_price_total decimal(15, 2) [not null, note: 'Harga Jual = Harga Pokok + Margin']
  monthly_installment decimal(15, 2) [not null]
  status varchar(50) [not null, default: 'Pending', note: 'Pending, Approved, Rejected, Active, Fully Paid']
  application_date timestamp [not null, default: `now()`]
  approval_date timestamp
  rejection_reason text
  agreement_signed_at timestamp [note: 'Waktu saat anggota menyetujui akad digital']
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table installment_bills {
  id integer [pk, increment]
  financing_application_id integer [not null, ref: > financing_applications.id]
  bill_number integer [not null, note: 'Cicilan ke- (1, 2, 3, ...)']
  amount decimal(15, 2) [not null]
  due_date date [not null]
  payment_date date
  status varchar(50) [not null, default: 'Unpaid', note: 'Unpaid, Paid, Overdue']
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  
  Indexes {
    (financing_application_id, bill_number) [unique]
  }
}
```